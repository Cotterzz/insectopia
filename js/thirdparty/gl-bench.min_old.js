'use strict';var GLBench=function(){class e{constructor(b,a={}){this.names=[];this.frameId=0;this.cpuAccums=[];this.gpuAccums=[];this.activeAccums=[];this.cpuLogger=()=>{};this.gpuLogger=()=>{};this.fpsLogger=()=>{};this.now=()=>performance&&performance.now?performance.now():Date.now();Object.assign(this,a);if(b instanceof WebGLRenderingContext||b instanceof WebGL2RenderingContext){let c=(c,a)=>function(){const f=a.now();c.apply(b,arguments);b.readPixels(0,0,1,1,b.RGBA,b.UNSIGNED_BYTE,new Uint8Array(4));
const d=a.now()-f;a.activeAccums.forEach((b,c)=>{b&&(a.gpuAccums[c]+=d,a.cpuAccums[c]-=d)})};"drawArrays drawElements drawArraysInstanced drawBuffers drawElementsInstanced drawRangeElements".split(" ").forEach(a=>{b[a]&&(b[a]=c(b[a],this))})}if(!this.withoutUI){a=function(a,b,g,f,e,h,k){this.elm=h.getElementsByClassName(a);this.pct=h.getElementsByClassName(g);this.names=k;return(a,c,d)=>{this.elm[d].innerHTML=b(a,c);this.pct[d].style["gl-box"==g?"fill":"strokeDasharray"]=f(a);e(a,c,this.names[d])}};
this.dom=document.getElementById("gl-bench-dom");if(!this.dom){document.body.insertAdjacentHTML("afterbegin",'<div id="gl-bench-dom" style="position:absolute;left:0;top:0;z-index:1000"></div>');this.dom=document.getElementById("gl-bench-dom");let a=document.createElement("style");a.innerHTML=".gl-bench{position:relative;display:block;margin:5px;width:100px;cursor:pointer;}.gl-box{fill:hsla(120, 50%, 60%, 0.65);}.gl-text{font-family:sans-serif;font-weight:700;font-size:0.7em;text-anchor:middle;dominant-baseline:middle;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:0.7;}.gl-arc{fill:none;stroke:black;stroke-width:2.6;stroke-dasharray:0, 100;opacity:0.5;transform:scale(1.25663);}.gl-circle{fill:none;stroke-width:3.5;stroke:black;opacity:0.4;}";
this.dom.appendChild(a)}this.dom.addEventListener("click",()=>{this.showMS=!this.showMS});this.fpsLogger=a.bind({})("gl-fps",(a,b)=>this.showMS?b.toFixed(2)+" MS":a.toFixed(0)+" FPS","gl-box",a=>"hsla("+Math.min(120,Math.max(0,2.182*(a-5)))+",50%,60%,0.65)",this.fpsLogger,this.dom,this.names);this.cpuLogger=a.bind({})("gl-cpu",(a,b)=>this.showMS?b.toFixed(2):a.toFixed(0)+"%","gl-cpu-arc",a=>a.toFixed(0)+", 100",this.cpuLogger,this.dom,this.names);this.gpuLogger=a.bind({})("gl-gpu",(a,b)=>this.showMS?
b.toFixed(2):a.toFixed(0)+"%","gl-gpu-arc",a=>a.toFixed(0)+", 100",this.gpuLogger,this.dom,this.names)}}addUI(b){this.names.push(b);this.dom&&this.dom.insertAdjacentHTML("beforeend",'<svg viewBox="0 0 100 70" class="gl-bench"><rect x="0" y="0" width="100" height="70" rx="26.5" ry="26.5" class="gl-box"/><text x="26.5" y="22" class="gl-text gl-cpu">00%</text><text x="26.5" y="34" class="gl-text">CPU</text><circle cx="26.5" cy="26.5" r="20" class="gl-circle"/><path d="M21.0 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-cpu-arc"/><circle cx="73.5" cy="26.5" r="20" class="gl-circle"/><text x="73.5" y="22" class="gl-text gl-gpu">00%</text><text x="73.5" y="34" class="gl-text">GPU</text><path d="M58.5 37 a 15.9155 -15.9155 0 0 1 0 -31.831 a 15.9155 15.9155 0 0 1 0 31.831"class="gl-arc gl-gpu-arc"/><text x="50" y="59" font-size=".8em" class="gl-text gl-fps">00 FPS</text><circle cx="18" cy="58" r="3" style="opacity:0.55"/><circle cx="82" cy="58" r="3" style="opacity:0.55"/></svg>')}begin(b){let a=
this.names.indexOf(b);-1==this.names.indexOf(b)&&(a=this.names.length,this.addUI(b));0===a&&this.frameId++;this.cpuAccums.length<=a&&(this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1));this.update();this.activeAccums[a]=!this.activeAccums[a]}end(b){b=this.names.indexOf(b);this.update();this.activeAccums[b]=!this.activeAccums[b]}update(){let b=this.now();if("undefined"==typeof this.zerotime)this.zerotime=b;else{let c=b-this.prevNow;this.activeAccums.forEach((a,b)=>{a&&(this.cpuAccums[b]+=
c)});let d=b-this.zerotime;var a=d/1E3;if(1<=a){a=this.frameId/a;let c=d/this.frameId;for(let b=0;b<this.cpuAccums.length;b++)this.cpuLogger(this.cpuAccums[b]/d*100,this.cpuAccums[b]/this.frameId,b),this.gpuLogger(this.gpuAccums[b]/d*100,this.gpuAccums[b]/this.frameId,b),this.fpsLogger(a,c,b),this.cpuAccums[b]=0,this.gpuAccums[b]=0;this.frameId=0;this.zerotime=b}}this.prevNow=this.now()}}return e}();
